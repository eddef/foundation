{% extends "base.html" %}

{% block nav-trade-class %} active{% endblock %}

{% load staticfiles %}

{% block content %}

<div ng-app="foundationApp">

<footer class="navbar navbar-default navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle"
              data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#/">Freicoin Foundation</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav" ng-controller="NavigationCtrl">
        {% block nav %}
        <li ng-class="navClass('donations')"><a href="#/donations">Donations</a></li>
        <li ng-class="navClass('trade')"><a href="#/trade">Trade</a></li>
        <li ng-class="navClass('about')"><a href="#/about">About</a></li>
        {% endblock %}
      </ul>
      <ul class="nav navbar-nav navbar-right">
        {% block auth %}
        <li>
          <form name="form" ng-controller="LoginCtrl" novalidate>
            {% if user.is_authenticated %}
              <input class="btn btn-xs btn-default" type="button" value="Logout" 
                     ng-click="logout();" />
            {% else %}
              <input type="text" name="login" id="username" ng-model="username" 
                     size="10" auto-fill-sync/>
              <input type="password" name="password" id="password" ng-model="password" 
                     size="10" auto-fill-sync/>
              <input class="btn btn-xs btn-default" type="submit" value="Login" 
                     ng-disabled="!username || !password" ng-click="login();" />
              <a class="btn btn-xs btn-default" href="#/register"/>Register</a>
            {% endif %}
          </form>
        </li>
      {% endblock auth %}
      </ul>
    </div>
  </div>
</footer>

{% verbatim %}

<div ng-switch="messages.length != null" ng-cloak>
  <div ng-switch-when="true">
    <div class="alert alert-{{message_style}}" ng-repeat="message in messages">
      <li>{{ message }}</li>
    </div>
    
  </div>
  <!-- If doesn't has length it's an object/dictionary -->
  <div ng-switch-when="false">
    <div class="alert alert-{{message_style}}" ng-repeat="(key, values) in messages">

      <div ng-switch="isString(values)">
        <div ng-switch-when="true">
          <strong> {{ key }} </strong> {{ values }}
        </div>
        <div ng-switch-when="false">

          <div ng-switch="values.length > 1">
            <div ng-switch-when="true">
              <strong> {{ key }} </strong>
              <ul ng-repeat="value in values">
                <li>{{ value }}</li>
              </ul>
            </div>
            <div ng-switch-when="false">
              <strong> {{ key }} </strong> {{ values[0] }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div ng-view></div>
</div>

{% endverbatim %}
{% endblock %}

{% block app-scripts %}

<script type="text/javascript">

angular.module('django_constants', [])
  .constant('django', {
    "user_authenticated": {% if user.is_authenticated %}1{% else %}0{% endif %},
    "user_id": {% if user.is_authenticated %} {{ user.id }} {% else %} null {% endif %},
    "trade_admin": {% if perms.trade.change_merchant %} 1 {% else %} null {% endif %},
    "donations_admin": {% if perms.donations.change_organization %} 1 {% else %} null {% endif %},
    "csrf_token": "{{ csrf_token }}",
    "static_urls": {
      "home": "{% static 'html/home.html' %}",
      "register": "{% static 'html/register_form.html' %}",
      "about": "{% static 'html/about.html' %}",
      "copyright": "{% static 'html/copyright.html' %}",
      "trade_list": "{% static 'html/trade/merchant_list.html' %}",
      "trade_detail": "{% static 'html/trade/merchant_detail.html' %}",
      "trade_form": "{% static 'html/trade/merchant_form.html' %}",
      "donations_list": "{% static 'html/donations/organization_list.html' %}",
      "donations_detail": "{% static 'html/donations/organization_detail.html' %}",
      "donations_form": "{% static 'html/donations/organization_form.html' %}"
    },
    "urls": {
      "login": "{% url 'login' %}",
      "logout": "{% url 'logout' %}",
      "register": "{% url 'register' %}",
      "trade_categories": "{% url 'trade_categories' %}",
      "trade_category_tree": "{% url 'trade_category_tree' %}",
      "trade_merchant_detail": "{% url 'trade_merchant_detail' %}",
      "trade_merchant_edit": "{% url 'trade_merchant_edit' %}",
      "trade_merchant_validate": "{% url 'trade_merchant_validate' %}",
      "frc_explorer": "{{ frc_explorer }}",
      "btc_explorer": "{{ btc_explorer }}",
      "donations_categories": "{% url 'donations_categories' %}",
      "donations_category_tree": "{% url 'donations_category_tree' %}",
      "donations_organization_detail": "{% url 'donations_organization_detail' %}",
      "donations_organization_edit": "{% url 'donations_organization_edit' %}",
      "donations_organization_validate": "{% url 'donations_organization_validate' %}"
    }
  });

</script>

<script src="{% static 'js/app.js' %}"></script>
<script src="{% static 'js/filters.js' %}"></script>
<script src="{% static 'js/directives/common.js' %}"></script>
<script src="{% static 'js/directives/validators.js' %}"></script>

<script src="{% static 'js/controllers/navigationCtrl.js' %}"></script>
<script src="{% static 'js/controllers/accountsCtrls.js' %}"></script>
<script src="{% static 'js/controllers/tradeCtrls.js' %}"></script>
<script src="{% static 'js/controllers/donationsCtrls.js' %}"></script>

<script src="{% static 'js/services/commonSrvs.js' %}"></script>
<script src="{% static 'js/services/tradeSrvs.js' %}"></script>
<script src="{% static 'js/services/donationsSrvs.js' %}"></script>

{% endblock %}

