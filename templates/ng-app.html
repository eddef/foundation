{% extends "base.html" %}

{% block nav-trade-class %} active{% endblock %}

{% load staticfiles %}

{% block content %}

<div ng-app="appTrade">

{% verbatim %}
<div ng-switch="messages.length != null">
  <div ng-switch-when="true">
    <div class="alert alert-{{message_style}}" ng-repeat="message in messages">
      <li>{{ message }}</li>
    </div>
    
  </div>
  <!-- If doesn't has length it's an object/dictionary -->
  <div ng-switch-when="false">
    <div class="alert alert-{{message_style}}" ng-repeat="(key, values) in messages">

      <div ng-switch="isString(values)">
        <div ng-switch-when="true">
          <strong> {{ key }} </strong> {{ values }}
        </div>
        <div ng-switch-when="false">

          <div ng-switch="values.length > 1">
            <div ng-switch-when="true">
              <strong> {{ key }} </strong>
              <ul ng-repeat="value in values">
                <li>{{ value }}</li>
              </ul>
            </div>
            <div ng-switch-when="false">
              <strong> {{ key }} </strong> {{ values[0] }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endverbatim %}

  <div ng-view></div>
</div>

{% endblock %}

{% block app-scripts %}

<script type="text/javascript">

angular.module('django_constants', [])
  .constant('django', {
    "user_authenticated": {% if user.is_authenticated %}1{% else %}0{% endif %},
    "user_id": {% if user.is_authenticated %} {{ user.id }} {% else %} null {% endif %},
    "trade_admin": {% if perms.trade.change_merchant %} 1 {% else %} null {% endif %},
    "csrf_token": "{{ csrf_token }}",
    "static_urls": {
      "list": "{% static 'trade/partials/merchant_list.html' %}",
      "detail": "{% static 'trade/partials/merchant_detail.html' %}",
      "edit": "{% static 'trade/partials/merchant_form.html' %}"
    },
    "urls": {
      "trade_categories": "{% url 'trade_categories' %}",
      "trade_category_tree": "{% url 'trade_category_tree' %}",
      "trade_merchant_detail": "{% url 'trade_merchant_detail' %}",
      "trade_merchant_edit": "{% url 'trade_merchant_edit' %}",
      "trade_merchant_validate": "{% url 'trade_merchant_validate' %}"
    }
  });

</script>

<script src="{% static 'trade/js/app.js' %}"></script>
<script src="{% static 'trade/js/controllers.js' %}"></script>
<script src="{% static 'trade/js/services.js' %}"></script>
<script src="{% static 'trade/js/commonServices.js' %}"></script>
{% endblock %}

